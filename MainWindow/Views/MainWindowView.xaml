<mah:MetroWindow x:Class="SFTemplateGenerator.MainWindow.Views.MainWindowView"
        xmlns:cm="http://caliburnmicro.com"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:SFTemplateGenerator.MainWindow.Views"
        mc:Ignorable="d"
        Title="四方屏柜自动化脚本生成器" Height="450" Width="800" WindowState="Maximized" >
    
    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <cm:ActionMessage MethodName="Window_Loaded">
                <cm:Parameter Value="$source"/>
                <cm:Parameter Value="$eventArgs"/>
            </cm:ActionMessage>
        </b:EventTrigger>
    </b:Interaction.Triggers>
    
    <DockPanel>
        <StackPanel DockPanel.Dock="Top">
            <DockPanel Visibility="{Binding ExceptionSectionVisibility}" Background="#D9b612" Margin="2"  >
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" Margin="2,0,2,0">
                    <Button Content="继续生成" Margin="0,0,1,0" Visibility="{Binding ContinueButtonVisibility}" >
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <cm:ActionMessage MethodName="ContinueGenerateProcessingButtonClicked">
                                    <cm:Parameter Value="$source"/>
                                    <cm:Parameter Value="$eventArgs"/>
                                </cm:ActionMessage>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </Button>
                    <Button Content="停止生成" Margin="1,0,0,0">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <cm:ActionMessage MethodName="StopGenerateProcessingButtonClicked">
                                    <cm:Parameter Value="$source"/>
                                    <cm:Parameter Value="$eventArgs"/>
                                </cm:ActionMessage>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </Button>
                </StackPanel>
                <TextBlock Text="{Binding ExceptionMessage}" VerticalAlignment="Center" FontSize="16" Background="Transparent" Margin="5,2,2,2" TextWrapping="Wrap">
                    
                </TextBlock>
            </DockPanel>
        </StackPanel>
        <Grid>
            <DockPanel>
                <ToolBarTray DockPanel.Dock="Top">
                    <ToolBar ClipToBounds="False" Style="{StaticResource MaterialDesignToolBar}">
                        <StackPanel >
                            <Button Content="{materialDesign:PackIcon Kind=Home}"  
                     cm:Message.Attach="[Event Click] = [Action HomeMenuClicked($source, $eventArgs)]" Style="{StaticResource MaterialDesignIconForegroundButton}"/>
                            <TextBlock Text="首页" Margin="10,0,5,0"/>
                        </StackPanel>
                        <Separator />
                        <StackPanel >
                            <Button Content="{materialDesign:PackIcon Kind=FolderOpen}" ToolTip="打开CDD文件" 
  cm:Message.Attach="[Event Click] = [Action OpenCDDFileMenuClicked($source, $eventArgs)]" Style="{StaticResource MaterialDesignIconForegroundButton}"/>
                            <TextBlock Text="打开CDD文件"/>
                        </StackPanel>
                        <StackPanel >
                            <Button Content="{materialDesign:PackIcon Kind=Cog }" ToolTip="程序设置"
cm:Message.Attach="[Event Click] = [Action SystemConfigurationMenuClicked($source, $eventArgs)]" Style="{StaticResource MaterialDesignIconForegroundButton}"/>
                            <TextBlock Text="程序设置" Margin="10,0,5,0"/>
                        </StackPanel>
                        <Separator />
                        <StackPanel >
                            <Button Content="{materialDesign:PackIcon Kind=ExitToApp }" ToolTip="退出"
                 cm:Message.Attach="[Event Click] = [Action ExitMenuClicked($source, $eventArgs)]" Style="{StaticResource MaterialDesignIconForegroundButton}"/>
                            <TextBlock Text="退出" Margin="10,0,5,0"/>
                        </StackPanel>
                    </ToolBar>
                </ToolBarTray>
                <!-- 关键绑定：使用 ActiveItem 属性 -->
                <ContentControl cm:View.Model="{Binding ActiveItem}" />
            </DockPanel>
            <Grid>
                <local:LoadingWindowView  x:Name="LoadingWindow"   Visibility="{Binding IsLoading}"/>
            </Grid>
        </Grid>
    </DockPanel>
</mah:MetroWindow>
